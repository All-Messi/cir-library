{{/*
    pdf-link.html — Renders a PDF download icon/button.
    
    Styles:
      "default"  — small inline link with icon + "PDF" text (essays, book index)
      "toolbar"  — minimal icon-only, matches chapter toolbar
      "nav"      — small subtle link for nav bars (harmony)
    
    Usage:
      {{ partial "pdf-link.html" . }}
      {{ partial "pdf-link.html" (dict "page" . "style" "toolbar") }}
*/}}

{{ $page := . }}
{{ $style := "default" }}

{{ if reflect.IsMap . }}
    {{ $page = .page }}
    {{ $style = .style | default "default" }}
{{ end }}

{{ $pdfPath := "" }}
{{ $tooltip := "Download PDF" }}

{{ $rel := $page.RelPermalink }}
{{ $rel = $rel | replaceRE "^/[^/]+/" "" | replaceRE "/$" "" }}

{{/* ---- HARMONY SECTION ---- */}}
{{ if eq ($page.Params.type | default "") "harmony-section" }}
    {{ $pdfPath = "pdfs/translations/harmony/the-harmonized-gospels.pdf" }}
    {{ $tooltip = "Download Harmony PDF" }}

{{/* ---- BIBLE CHAPTER ---- */}}
{{ else if eq ($page.Params.type | default "") "chapter" }}
    {{ $parentRel := $page.Parent.RelPermalink | replaceRE "^/[^/]+/" "" | replaceRE "/$" "" }}
    {{ if $parentRel }}
        {{ $pdfPath = printf "pdfs/%s.pdf" $parentRel }}
    {{ end }}
    {{ $tooltip = printf "Download %s PDF" ($page.Params.book | default "Book") }}

{{/* ---- BIBLE BOOK INDEX ---- */}}
{{ else if eq ($page.Params.type | default "") "book" }}
    {{ if $rel }}
        {{ $pdfPath = printf "pdfs/%s.pdf" $rel }}
    {{ end }}
    {{ $tooltip = printf "Download %s PDF" ($page.Params.book | default $page.Title) }}

{{/* ---- ESSAY (default) ---- */}}
{{ else }}
    {{ if $rel }}
        {{ $pdfPath = printf "pdfs/%s.pdf" $rel }}
    {{ end }}
    {{ $tooltip = "Download PDF" }}
{{ end }}

{{/* ---- RENDER ---- */}}
{{ if $pdfPath }}
    {{ if eq $style "toolbar" }}
        {{/* Icon-only for chapter toolbar — borderless, subtle */}}
        <a href="{{ $pdfPath | relURL }}" target="_blank" class="toolbar-btn pdf-btn-minimal" data-tip="PDF">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 1h5.5L13 4.5V13a2 2 0 01-2 2H5a2 2 0 01-2-2V3a2 2 0 012-2z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.5 1v4H13" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 8v4M6 10l2 2 2-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
    {{ else }}
        {{/* Small inline text link for essays, book index, harmony */}}
        <a href="{{ $pdfPath | relURL }}" target="_blank" class="pdf-download" title="{{ $tooltip }}">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M4 1h5.5L13 4.5V13a2 2 0 01-2 2H5a2 2 0 01-2-2V3a2 2 0 012-2z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.5 1v4H13" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 8v4M6 10l2 2 2-2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span>PDF</span>
        </a>
    {{ end }}
{{ end }}
